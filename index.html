<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente Imobili√°rio IA</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: #f9fafb; height: 100vh; overflow: hidden; }
        .container { display: flex; flex-direction: column; height: 100vh; }
        .header { background: linear-gradient(135deg, #2563eb, #1e40af); color: white; padding: 1.5rem; }
        .header h1 { font-size: 1.75rem; margin-bottom: 0.25rem; }
        .messages { flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; }
        .message { display: flex; }
        .message.user { justify-content: flex-end; }
        .msg-bubble { max-width: 65%; padding: 0.875rem 1.25rem; border-radius: 1rem; white-space: pre-wrap; }
        .message.user .msg-bubble { background: #2563eb; color: white; }
        .message.ai .msg-bubble { background: #e5e7eb; color: #1f2937; }
        .input-area { background: white; border-top: 2px solid #e5e7eb; padding: 1rem; display: flex; gap: 0.75rem; }
        input { flex: 1; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-weight: 600; cursor: pointer; }
        input:focus { outline: none; border: 2px solid #2563eb; }
        .btn { padding: 0.75rem 1.25rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; }
        .btn-send { background: #2563eb; color: white; flex: 1; }
        .btn-lead { background: #16a34a; color: white; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 50; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 1rem; padding: 2rem; max-width: 32rem; width: 90%; }
        .form-group { margin-bottom: 1.25rem; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 0.5rem; }
        .form-group input, .form-group textarea { width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; }
        .form-buttons { display: flex; gap: 0.75rem; }
        .btn-submit { background: #2563eb; color: white; flex: 1; }
        .btn-cancel { background: #f3f4f6; color: white; flex: 1; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Assistente Imobili√°rio IA</h1>
            <p>Busca inteligente + Gerenciamento de leads</p>
        </div>
        <div class="messages" id="m"></div>
        <div class="input-area">
            <form id="f" style="display: flex; width: 100%; gap: 0.75rem;">
                <input id="i" placeholder="Digite sua busca..." autocomplete="off">
                <button type="submit" class="btn btn-send">Enviar</button>
                <button type="button" class="btn btn-lead" onclick="openModal()">+ Lead</button>
            </form>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <h2>Registrar Lead</h2>
            <form id="lf">
                <div class="form-group">
                    <label>Nome</label>
                    <input id="n" placeholder="Ex: Joao Silva" required>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input id="t" placeholder="Ex: (55) 99999-9999" required>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <textarea id="d" placeholder="Detalhes..." rows="4" required></textarea>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn btn-submit">Registrar</button>
                    <button type="button" class="btn btn-cancel" onclick="closeModal()" style="background: #f3f4f6; color: #1f2937;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const S = 'https://topxretiehpulhyovfhg.supabase.co', K = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvcHhyZXRpZWhwdWxoeW92ZmhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxODgzNzcsImV4cCI6MjA3ODc2NDM3N30.9OkH4JAl8Eb13sKZyW--9CsdTBDtqBGYvRz10nRW5EA';
        const S_CLIENT = supabase.createClient(S, K);
        const m = document.getElementById('m');
        const f = document.getElementById('f');
        const lf = document.getElementById('lf');
        const modal = document.getElementById('modal');
        
        function openModal() {
            modal.classList.add('active');
        }
        
        function closeModal() {
            modal.classList.remove('active');
            lf.reset();
        }
        
        function addMsg(txt, isUser) {
            const d = document.createElement('div');
            d.className = isUser ? 'message user' : 'message ai';
            const b = document.createElement('div');
            b.className = 'msg-bubble';
            b.textContent = txt;
            d.appendChild(b);
            m.appendChild(d);
            m.scrollTop = m.scrollHeight;
        }
        
        lf.onsubmit = async (e) => {
            e.preventDefault();
            const n_val = document.getElementById('n').value;
            const t_val = document.getElementById('t').value;
            const d_val = document.getElementById('d').value;
            
            try {
                const { data, error } = await S_CLIENT.from('clients').insert([{ nome: n_val, telefone: t_val }]);
                if (error) throw error;
                
                addMsg(`‚úÖ Lead '${n_val}' registrado!\n\nDescricao: ${d_val}\nTelefone: ${t_val}`, false);
                closeModal();
            } catch (err) {
                addMsg(`‚ùå Erro ao registrar: ${err.message}`, false);
            }
        };
        
        f.onsubmit = async (e) => {
            e.preventDefault();
            const q = document.getElementById('i').value;
            if (!q.trim()) return;
            
            addMsg(q, true);
            document.getElementById('i').value = '';
            
            try {
                const { data, error } = await S_CLIENT.from('clients').select('*').filter('nome', 'ilike', `%${q}%`);
                if (error) throw error;
                
                if (data.length === 0) {
                    addMsg('Nenhum lead encontrado com essa busca.', false);
                } else {
                    let result = `Encontrei ${data.length} lead(s):\n\n`;
                    data.forEach((lead, i) => {
                        result += `${i + 1}. ${lead.nome} - ${lead.telefone}\n`;
                    });
                    addMsg(result, false);
                }
            } catch (err) {
                addMsg(`Erro na busca: ${err.message}`, false);
            }
        };
        
        addMsg('Ol√°! üëã Bem-vindo ao Assistente Imobili√°rio IA!\n\nClique em "+ Lead" para registrar novos leads, ou use a busca para encontrar propriedades.', false);
    </script>
</body>
</html>
